<%
=begin
  This is a template for generating HTML files for the blog.

  The following variables are available for use in this template:
  * BLOG            => data from the blog configuration file
  * ENTRIES         => an array of all available blog entries
  * TAGS            => a hash of the form: {name => array of entries}
  * ARCHIVES        => a hash of the form: {name => array of entries}
  * CHAPTERS        => an array of objects like TAGS and ARCHIVES
  * @page_title     => title of the HTML page
  * @page_content   => body of the HTML page
=end
%>
<%
  # Recursively expands the given BLOG.menu data structure into an itemized list of links.
  def render_menu aMenu
    result = ''

    if aMenu.respond_to? :to_ary
      aMenu.each do |link|
        result << render_menu(link)
      end
    elsif aMenu.respond_to? :each_pair
      aMenu.each_pair do |name, url|
        link = if url.respond_to? :to_ary
          "#{name} <ul>#{render_menu url}</ul>"
        else
          %{<a href="#{url}">#{name}</a>}
        end

        result << "<li>#{link}</li>"
      end
    else
      result << "<li>#{aMenu}</li>"
    end

    result << "\n"
  end
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=<%= BLOG.encoding %>" />
    <meta http-equiv="content-language" content="<%= BLOG.language %>" />
    <meta name="description" content="<%=h BLOG.info %>" />
    <meta name="date" content="<%= DateTime.now %>" />
    <meta name="author" content="<%=h BLOG.author %>" />
    <meta name="generator" content="Rassmalog" />

    <link rel="alternate" type="application/rss+xml" href="rss.xml" title="RSS feed for this blog." />
    <link rel="stylesheet" type="text/css" href="style.css" />

    <title><%= BLOG.name %> &mdash; <%= @page_title %></title>
  </head>
  <body>
    <div id="header">
      <h1 class="name"><%= BLOG.name %></h1>
      <blockquote class="info"><%= BLOG.info %></blockquote>
    </div>

    <div id="menu">
      <a href="index.html"><img src="images/tango/home.png" alt="Home" title="Home" /></a>
      <a type="application/rss+xml" href="rss.xml"><img src="images/mozilla/feed-icon.png" alt="RSS feed for this blog." title="RSS feed for this blog." /></a>

      <ul>
        <!-- the heirarchical navigation menu -->
        <%= render_menu BLOG.menu %>

        <!-- listing of the most recent entries -->
        <li>Recent
          <ul>
            <% ENTRIES.recent.each do |entry| %>
              <li><%= entry.to_link %></li>
            <% end %>
          </ul>
        </li>

        <!-- listing of all archives -->
        <% CHAPTERS.each do |chapter| %>
          <li><%= chapter.name %>
            <ul>
              <% chapter.pages.sort.each do |page| %>
                <li><%= page.to_link %> (<%= chapter[page].length %>)</li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>
    </div>

    <%= @page_content %>

    <div id="footer">
      Authored by <%= BLOG.author %>.
      <br/>
      Generated by <a href="http://rassmalog.rubyforge.org">Rassmalog</a>.
    </div>
  </body>
</html>
