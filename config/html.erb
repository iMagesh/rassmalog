<%
=begin
  This is a template for generating a complete HTML web page.

  The following variables are available for use in this template:
  * BLOG           => data from the blog configuration file
  * LANG           => data from the translation file
  * ENTRIES        => array of all blog entries (Entry objects)
  * RECENT_ENTRIES => array of recent blog entries (Entry objects)
  * TAGS           => array of all tags (Section objects)
  * ARCHIVES       => array of all archives (Section objects)
  * @target        => object for which we are generating HTML
  * @title         => title for the HTML page we are generating
  * @content       => body for the HTML page we are generating
=end

  name_html   = BLOG.name.to_html
  info_html   = BLOG.info.to_html
  author_html = BLOG.author.to_html
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=<%= BLOG.encoding %>" />
    <meta http-equiv="content-language" content="<%= BLOG.language %>" />
    <meta name="description" content="<%=h info_html %>" />
    <meta name="date" content="<%= DateTime.now.rfc822 %>" />
    <meta name="author" content="<%=h author_html %>" />
    <meta name="generator" content="<%= GENERATOR %>" />

    <link rel="alternate" type="application/rss+xml" href="rss.xml" title="RSS feed for this blog." />
    <link rel="stylesheet" type="text/css" href="styles/screen.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="styles/print.css" media="print" />
    <link rel="alternate stylesheet" type="text/css" href="styles/print.css" title="Print Preview" />

    <title><%= @title %> &mdash; <%= name_html %></title>
  </head>
  <body>
    <%# improves usability in text-mode browsers %>
    <div style="display: none">
      <a href="#menu">Jump to navigation menu</a>
      <br/>
      <a href="#content">Jump to page content</a>
      <hr/>
    </div>

    <div id="header">
      <h1 class="name"><%= name_html %></h1>
      <div class="info"><%= info_html %></div>
    </div>

    <br style="display: none"/>
    <hr style="display: none"/>

    <div id="content"><%= @content %></div>

    <hr style="display: none"/>

    <div id="menu">
      <div id="menu-blog">
        <%= link 'index.html', LANG['Home'] %> &middot;
        <%= RECENT_ENTRIES.to_link %> &middot;
        <%= ENTRIES.to_link %> &middot;
        <%= TAGS.to_link %> &middot;
        <%= ARCHIVES.to_link %> &middot;
        <a type="application/rss+xml" href="rss.xml">
          <%= LANG['Subscribe'] %>
          <img src="images/feed-icon-14x14.png" alt="RSS feed" title="RSS feed" />
        </a>
      </div>

      <br style="display: none"/>

      <form id="search" method="get" <%=
        if @title == LANG['Search']
          # avoid having to reload the entire search page (which can get very
          # large in file size) each time the user submits the search form
          %{action="#" onsubmit="search_handler(); return false;"}
        else
          %{action="#{LANG['Search'].to_file_name}.html"}
        end
      %>>
        <input type="text" name="q" id="search-query"/>
        <input type="submit" value="<%= LANG['Search'] %>"/>
      </form>

      <br style="display: none"/>
      <br style="display: none"/>

      <% if BLOG.menu %>
      <ul id="menu-user"><%= BLOG.menu.to_html %></ul>
      <% end %>
    </div>

    <hr style="display: none"/>

    <div id="footer">
      Authored by <%=
        if BLOG.email
          link BLOG.email.to_url, author_html
        else
          author_html
        end
      %>.
      <br/>
      Generated by <%= GENERATOR.to_link %>.
    </div>
  </body>
</html>
