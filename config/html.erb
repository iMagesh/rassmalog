<%
=begin
  This is a template for generating a complete HTML web page.

  The following variables are available for use in this template:
  * BLOG        - data from the blog configuration file
  * LANG        - data from the translation file
  * SEARCH_PAGE - the blog entry corresponding to the search page
  * ENTRIES     - array of all blog entries (Entry objects)
  * NEW_ENTRIES - array of recent blog entries (Entry objects)
  * TAGS        - array of all tags (Section objects)
  * ARCHIVES    - array of all archives (Section objects)
  * FEEDS       - array of all feeds (Feed objects)
  * @target     - object for which we are generating HTML
  * @title      - title for the HTML page we are generating
  * @content    - body for the HTML page we are generating

  NOTE that the "display: none" stuff in this template is meant to improve
  the readability and usability of this web page in text-only web browsers.
=end

  blogName   = BLOG.name.to_html
  blogInfo   = BLOG.info.to_html
  blogAuthor = BLOG.author.to_html
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=<%= BLOG.encoding %>" />
    <meta http-equiv="content-language" content="<%= BLOG.language %>" />
    <meta name="description" content="<%= h(
      if @target.is_a? Entry and summary = @target.summary
        summary
      else
        blogInfo
      end
    ) %>" />
    <% if @target.is_a? Entry and not @target.tags.empty? %>
      <meta name="keywords" content="<%= @target.tags.map {|t| t.name}.join(', ') %>" />
    <% end %>
    <meta name="date" content="<%= Time.now.rfc822 %>" />
    <meta name="author" content="<%=h blogAuthor %>" />
    <meta name="generator" content="<%= Rassmalog %>" />

    <% FEEDS.each do |feed| %>
      <link rel="alternate" type="application/rss+xml" href="<%= feed.file %>" title="<%=h feed.name %>" />
    <% end %>

    <link rel="stylesheet" type="text/css" href="styles/screen.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="styles/print.css" media="print" />
    <link rel="alternate stylesheet" type="text/css" href="styles/print.css" title="Print Preview" />

    <title><%= @title.to_html %> &mdash; <%= blogName %></title>
  </head>
  <body>
    <p style="display: none">
      <a href="#content">Skip to content</a>
      <br/>
      <a href="#navigation">Skip to navigation</a>
    </p>

    <div id="header">
      <h1 class="name"><%= link('index.html', blogName) %></h1>
      <div class="info"><%= blogInfo %></div>
    </div>

    <br style="display: none"/>

    <div id="navigation">
      <%
        # highlights the given item if it corresponds to the current web page
        def menu_item aItem
          if (@target.equal? aItem) or
             (aItem == ENTRIES and ENTRIES.include? @target) or
             (@target.is_a? Section and aItem == @target.parent)
          then
            %{<strong class="current">#{aItem.to_link}</strong>}
          else
            aItem.to_link
          end
        end
      %>

      <%= menu_item(NEW_ENTRIES) %>
      &middot;
      <%= menu_item(ENTRIES) %>
      &middot;
      <%= menu_item(TAGS) %>
      &middot;
      <%= menu_item(ARCHIVES) %>

      <% if SEARCH_PAGE %>
        &middot;
        <%= menu_item(SEARCH_PAGE) %>
      <% end %>

      <% unless FEEDS.empty? %>
        &middot;
        <a type="application/rss+xml" href="<%= FEEDS.first.file %>">
          <%= LANG['Subscribe'] %> <img src="images/feed-icon-14x14.png" alt="RSS feed" title="RSS feed" />
        </a>
      <% end %>
    </div>

    <ul id="links">
      <%= BLOG.links.to_html if BLOG.links %>

      <%# provide a list of all RSS feeds available on this blog %>
      <% if FEEDS.length > 1 %>
        <li>
          <%= LANG['Subscribe'] %> <img src="images/feed-icon-14x14.png" alt="RSS feed" title="RSS feed" />
          <ul>
            <% FEEDS.each do |feed| %>
              <li><a type="application/rss+xml" href="<%= feed.file %>"><%= feed.name.to_s.to_html %></a></li>
            <% end %>
          </ul>
        </li>
      <% end %>
    </ul>

    <br style="display: none"/>
    <hr style="display: none"/>

    <div id="content"><%= @content %></div>

    <%#
      ensure that a horizontal rule is present to
      separate the above content from the stuff below it
    %>
    <% if @content !~ %r{<hr.*?>(</.*?>|<[^/].*?/>|.)*\z}m %>
      <br style="display: none"/>
      <hr style="display: none"/>
    <% end %>

    <p id="footer">
      <%=
        author =
          if BLOG.email
            link BLOG.email.to_url, blogAuthor
          else
            blogAuthor
          end

        LANG["Authored by %s.", author]
      %>
      <br/>
      <%= LANG["Generated by %s.", Rassmalog.to_link] %>
    </p>
  </body>
</html>
