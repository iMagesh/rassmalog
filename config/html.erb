<%
# = List of available variables
# * @blog           => data from the blog configuration file
# * @entries        => an array of all available blog entries
# * @tags           => a hash of the form: {name => array of entries}
# * @archives       => a hash of the form: {name => array of entries}
# * @page_title     => title of the HTML page
# * @page_content   => body of the HTML page
%>
<%
  # Recursively expands the given @blog.navigation data structure into an itemized list of links.
  def navigation_to_html aLink
    result = ''

    if aLink.respond_to? :to_ary
      aLink.each do |link|
        result << navigation_to_html(link)
      end
    elsif aLink.respond_to? :each_pair
      aLink.each_pair do |name, url|
        link = if url.respond_to? :to_ary
          "#{name.capitalize}: <ul>#{navigation_to_html url}</ul>"
        else
          "<a href=#{url.inspect}>#{name}</a>"
        end

        result << "<li>#{link}</li>"
      end
    else
      result << "<li>#{aLink}</li>"
    end

    result << "\n"
  end
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=<%= @blog.encoding %>" />
    <meta http-equiv="content-language" content="<%= @blog.language %>" />
    <meta name="description" content=<%= @blog.info.inspect %> />
    <meta name="author" content="<%= @blog.author %>" />
    <meta name="date" content="<%= DateTime.now %>" />


    <link rel="alternate" type="application/rss+xml" href="rss.xml" title="RSS feed for this blog." />
    <link rel="stylesheet" type="text/css" href="style.css" />

    <title><%= @blog.name %> - <%= @page_title %></title>
  </head>
  <body>
    <div id="navigation">
      <a href="index.html"><img src="images/home.png" alt="Home" title="Home" /></a>
      <a type="application/rss+xml" href="rss.xml"><img src="images/feed-icon.png" alt="RSS feed for this blog." title="RSS feed for this blog." /></a>

      <ul>
        <%= navigation_to_html @blog.navigation %>

        <%
          # listing of entry archives
          {
            'Tags' => @tags,
            'Archives' => @archives,
          }.
          each_pair do |caption, hash|
        %>
          <li><%= caption %>:
            <ul>
              <% hash.keys.each do |key| %>
                <li><%= key.to_link %> (<%= hash[key].length %>)</li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>
    </div>
    <%= @page_content %>
  </body>
</html>
